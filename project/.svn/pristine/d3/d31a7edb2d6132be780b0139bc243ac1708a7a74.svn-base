;(function($){
	class List{
		constructor(options){
			this.left=options.left;
			this.right=options.right;
			this.pageCont=options.pageCont;
			this.index=options.index;
			this.cont=$(".cont");
			this.num=options.num;
			this.url="http://localhost/project/taocaixia/data/goods.json"
			this.load()
			this.addEvent()
			this.shu=options.shu
			this.addEvent1()
//			console.log(this.cont[0])
		}
		addEvent1(){	
			var that=this;
			console.log(1)
			this.cont[0].addEventListener("click",function(eve){
				if(eve.target.className == "btn"){
					that.id=eve.target.parentNode.getAttribute("qwe")
					that.setCookie()
				}
			})
		}
			setCookie(){
				console.log(this.id)		
				this.goods = getCookie("goods") ? JSON.parse(getCookie("goods")) : [];
				this.goods = getCookie("goods") ? JSON.parse(getCookie("goods")) : [];
				console.log(this.goods)
				console.log(this.goods.length)
				if(this.goods.length == 0){
            		console.log(1)					
					this.goods.push({
						id:this.id,
						num:1
					})
				}else{
					var i=0;
					var onoff=this.goods.some((value,index)=>{
						i=index;
						return value.id == this.id
					})
					if(onoff){
						this.goods[i].num++
					}else{
						this.goods.push({
							id:this.id,
							num:1
						})
					}	
				}
				setCookie("goods",JSON.stringify(this.goods));	
			}
			load(){
				var that=this
				$.ajax({
					type:"post",
					url:this.url,
					success:function(res){
						that.shu.innerHTML=res.length
						that.res= res
						that.display()
						that.createPage()
					}
				})
			}
			display(){
//				console.log(this.res)
				var str=""
				for(var i=this.index*this.num;i<(this.index+1)*this.num;i++){
//					console.log(1)
					if(i<this.res.length){
						str+=`<li class="box" qwe="${this.res[i].goodsId}">
								<img src="${this.res[i].url}"/>
								<span class="over">${this.res[i].name}</span>
								<p><i>价格：</i>￥${this.res[i].price}</p>
								<u class="btn">加入购物车</u><b>关注</b>
							</li>`
					}		
				}
				this.cont[0].innerHTML=str
			}
			createPage(){
				this.maxNum=Math.ceil(this.res.length/this.num)
				var str="";
				for(var i=0;i<this.maxNum;i++){
					str+=`<li>${i+1}</li>`
				}
				this.pageCont.innerHTML=str
//				console.log(this.pageCont)
				this.setActive()
			}
			setActive(){
				for(var i=0;i<this.maxNum;i++){
					this.pageCont.children[i].className=""
				}
				this.pageCont.children[this.index].className = "active";
			}
		addEvent(){	
			var that=this;
			this.left.onclick=function(){				
				that.changeIndex(0);
			}
			this.right.onclick=function(){				
				that.changeIndex(1);
			}
		}
		changeIndex(type){
			if(type==0){
				if(this.index==0){
					this.index = this.maxNum-1;
				}else{
					this.index--;
				}
			}else{
				if(this.index==this.maxNum-1){
					this.index=0
				}else{
					this.index++;
				}
			}
			this.setActive();
			this.display();
		}
		}
		new List({
			left:document.querySelector("#btnL"),
			right:document.querySelector("#btnR"),
			pageCont:document.querySelector("#page"),
			index:0,
			num:5,
			shu:document.querySelector(".shu")
		})
		
		
//		列表收起隐藏功能
			$(".shou").on("click",function(){
				if($(this).html() == "收起列表↑"){
					$(".lb").stop().slideUp(500);
					$(this).html("放下列表↓")
				}else{
					$(".lb").stop().slideDown(500);
					$(this).html("收起列表↑")
				}
			})
		
//		登陆后状态改变
		var msg = localStorage.getItem("loginUser");
    if(msg){
        $(".deng").hide();
        $(".zhu").hide();
        $(".hello").show();
        $(".hello").find("span").html(JSON.parse(msg).user);
    }else{
        $(".deng").show();
        $(".zhu").show();
        $(".hello").hide();
    }
    
    $(".hello").find("a").click(function(){
        localStorage.removeItem("loginUser");
       $(".deng").show();
        $(".zhu").show();
        $(".hello").hide();
    })

})(jQuery);
